<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal&display=swap" rel="stylesheet">
    <style>body{font-family:'Tajawal',sans-serif;background-color:#0F172A;color:#fff}.screen{display:none;position:fixed;inset:0;flex-direction:column}.screen.active{display:flex}</style>
</head>
<body>
    <!-- 1. Ø´Ø§Ø´Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ -->
    <div id="screen-binding" class="screen active items-center justify-center bg-white">
        <div class="w-full max-w-sm text-center p-6">
            <div class="w-16 h-16 bg-blue-100 rounded-full mx-auto mb-4 flex items-center justify-center">
                <span class="text-3xl">ğŸ”—</span>
            </div>
            <h2 class="text-xl font-bold text-gray-800 mb-2">Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„Ø±Ø¨Ø·</h2>
            <p class="text-gray-500 text-sm mb-6">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 9 Ø£Ø±Ù‚Ø§Ù…</p>
            
            <div id="code-container" class="flex justify-center mb-4 direction-ltr"></div>

            <button id="btn-confirm" onclick="confirmBinding()" disabled class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold opacity-50">Ø±Ø¨Ø· Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
            <p id="error-msg" class="text-red-500 text-xs mt-2 hidden"></p>
        </div>
    </div>

    <!-- 2. Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª -->
    <div id="screen-permissions" class="screen bg-gray-100">
        <div class="bg-white p-4 border-b shadow-sm">
            <h2 class="text-lg font-bold text-center text-gray-800">Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª</h2>
        </div>
        <div class="flex-1 overflow-y-auto p-4 space-y-3">
            <div class="bg-white rounded-xl p-3 flex items-center gap-3 shadow-sm">
                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">ğŸ”’</div>
                <div class="flex-1"><h3 class="font-bold text-sm text-gray-700">Ø®Ø¯Ù…Ø© Ø§Ù„ÙˆØµÙˆÙ„</h3></div>
                <button onclick="togglePerm('accessibility')" class="px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-lg font-bold">ØªÙØ¹ÙŠÙ„</button>
            </div>
            <div class="bg-white rounded-xl p-3 flex items-center gap-3 shadow-sm">
                <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">ğŸ“Š</div>
                <div class="flex-1"><h3 class="font-bold text-sm text-gray-700">Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h3></div>
                <button onclick="togglePerm('usage')" class="px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-lg font-bold">ØªÙØ¹ÙŠÙ„</button>
            </div>
            <div class="bg-white rounded-xl p-3 flex items-center gap-3 shadow-sm">
                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">ğŸ“</div>
                <div class="flex-1"><h3 class="font-bold text-sm text-gray-700">Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ</h3></div>
                <button onclick="togglePerm('location')" class="px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-lg font-bold">ØªÙØ¹ÙŠÙ„</button>
            </div>
            <div class="bg-white rounded-xl p-3 flex items-center gap-3 shadow-sm">
                <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center">ğŸ‘ï¸</div>
                <div class="flex-1"><h3 class="font-bold text-sm text-gray-700">Ø§Ù„Ø¹Ø±Ø¶ ÙÙˆÙ‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</h3></div>
                <button onclick="togglePerm('overlay')" class="px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-lg font-bold">ØªÙØ¹ÙŠÙ„</button>
            </div>
        </div>
        <div class="p-4 bg-white border-t">
            <button onclick="finishSetup()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold">ØªÙ…ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ù…Ø§ÙŠØ©</button>
        </div>
    </div>

    <!-- 3. Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ -->
    <div id="screen-success" class="screen items-center justify-center bg-green-50 p-6">
        <div class="text-center">
            <div class="w-20 h-20 bg-green-500 rounded-full mx-auto mb-4 flex items-center justify-center shadow-lg">
                <span class="text-4xl text-white">âœ“</span>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">ØªÙ… Ø¨Ù†Ø¬Ø§Ø­!</h2>
            <p class="text-gray-600 text-sm mb-6">Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ø±Ø¨ÙˆØ· ÙˆÙ…Ø­Ù…ÙŠ.</p>
        </div>
    </div>

    <script>
        // Logic
        function showScreen(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
        function callNative(fn, arg){ if(typeof AndroidNative!=='undefined'){ arg ? AndroidNative[fn](arg) : AndroidNative[fn](); } }

        // Code Inputs
        const codeContainer = document.getElementById('code-container');
        for(let i=0; i<9; i++){
            let input = document.createElement('input');
            input.type = 'number';
            input.maxLength = 1;
            input.style.cssText = "width:30px;height:40px;text-align:center;font-size:18px;font-weight:bold;border:2px solid #E5E7EB;border-radius:6px;outline:none;margin:2px";
            input.oninput = (e) => handleCodeInput(e, i);
            codeContainer.appendChild(input);
        }

        function handleCodeInput(e, index) {
            const inputs = codeContainer.getElementsByTagName('input');
            if(e.target.value.length === 1 && index < 8) inputs[index+1].focus();
            checkCodeComplete();
        }

        function checkCodeComplete() {
            const inputs = codeContainer.getElementsByTagName('input');
            let code = ""; for(let inp of inputs) code += inp.value;
            const btn = document.getElementById('btn-confirm');
            if(code.length === 9) { btn.disabled = false; btn.classList.remove('opacity-50'); }
            else { btn.disabled = true; btn.classList.add('opacity-50'); }
        }

        function confirmBinding() {
            const inputs = codeContainer.getElementsByTagName('input');
            let code = ""; for(let inp of inputs) code += inp.value;
            document.getElementById('error-msg').classList.add('hidden');
            callNative('linkDevice', code);
        }

        function togglePerm(type){ callNative('requestPermission', type); }
        function finishSetup(){ callNative('startServices'); showScreen('screen-success'); }

        // Native Callbacks
        window.onLinkSuccess = function(){ showScreen('screen-permissions'); };
        window.onLinkError = function(msg){ 
            document.getElementById('error-msg').innerText = msg; 
            document.getElementById('error-msg').classList.remove('hidden'); 
        };
    </script>
</body>
</html>
